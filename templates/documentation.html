<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Documentation - mPAY ONE API Integration</title>
    <link rel="stylesheet" href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="api-header">
        <div class="container">
            <div class="row">
                <div class="col-md-12 text-center">
                    <h1>mPAY ONE API Documentation</h1>
                    <p class="lead">Reference for integrating the mPAY ONE payment gateway</p>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="container">
        <div class="row">
            <div class="col-md-3">
                <!-- Sidebar Navigation -->
                <div class="sticky-top pt-4">
                    <div class="list-group mb-4">
                        <a href="#introduction" class="list-group-item list-group-item-action">Introduction</a>
                        <a href="#authentication" class="list-group-item list-group-item-action">Authentication</a>
                        <a href="#credit-card" class="list-group-item list-group-item-action">Credit Card Payments</a>
                        <a href="#qr-payment" class="list-group-item list-group-item-action">QR Payments</a>
                        <a href="#installment" class="list-group-item list-group-item-action">Installment Payments</a>
                        <a href="#rabbit-line-pay" class="list-group-item list-group-item-action">Rabbit Line Pay</a>
                        <a href="#internet-banking" class="list-group-item list-group-item-action">Internet Banking</a>
                        <a href="#inquiry" class="list-group-item list-group-item-action">Payment Inquiry</a>
                        <a href="#void-refund" class="list-group-item list-group-item-action">Void & Refund</a>
                        <a href="#webhook" class="list-group-item list-group-item-action">Webhook Notifications</a>
                        <a href="#report" class="list-group-item list-group-item-action bg-primary text-white">Project Report Documentation</a>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
                            <i data-feather="home" class="feather-sm"></i> Back to Home
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-9">
                <!-- Introduction -->
                <section id="introduction" class="api-doc">
                    <h2>Introduction</h2>
                    <p>
                        The mPAY ONE API allows you to integrate payment processing functionality into your website.
                        This documentation covers the main endpoints and features available through our integration.
                    </p>
                    <p>
                        The API provides endpoints for processing various payment methods, including credit cards,
                        QR payments, installment plans, and alternative payment methods.
                    </p>
                </section>
                
                <!-- Authentication -->
                <section id="authentication" class="api-doc">
                    <h2>Authentication</h2>
                    <p>
                        All API requests require a valid merchant ID and signature. The signature is generated using
                        HMAC SHA-256 with your secret key.
                    </p>
                    
                    <h3>Signature Generation</h3>
                    <div class="card mb-3">
                        <div class="card-body">
                            <pre><code>
// Example in Python
import hmac
import hashlib
import json

def generate_signature(data, secret_key):
    # Sort the payload keys alphabetically
    sorted_data = {k: data[k] for k in sorted(data.keys())}
    
    # Convert payload to JSON string
    payload_string = json.dumps(sorted_data, separators=(',', ':'))
    
    # Create HMAC with SHA-256
    signature = hmac.new(
        secret_key.encode('utf-8'),
        payload_string.encode('utf-8'),
        hashlib.sha256
    ).hexdigest()
    
    return signature
                            </code></pre>
                        </div>
                    </div>
                </section>
                
                <!-- Credit Card Payments -->
                <section id="credit-card" class="api-doc">
                    <h2>Credit Card Payments</h2>
                    
                    <h3>Payment Order</h3>
                    <div class="api-endpoint">
                        <span class="method">POST</span> /api/credit-card/payment
                    </div>
                    
                    <p>Create a credit card payment order to redirect the customer to the payment page.</p>
                    
                    <div class="api-params">
                        <h4>Request Parameters</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>merchant_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Your merchant ID</td>
                                </tr>
                                <tr>
                                    <td>order_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Unique order identifier</td>
                                </tr>
                                <tr>
                                    <td>amount</td>
                                    <td>Number</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Transaction amount</td>
                                </tr>
                                <tr>
                                    <td>currency</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Currency code (e.g., THB)</td>
                                </tr>
                                <tr>
                                    <td>redirect_url</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>URL to redirect after payment</td>
                                </tr>
                                <tr>
                                    <td>description</td>
                                    <td>String</td>
                                    <td>No</td>
                                    <td>Payment description</td>
                                </tr>
                                <tr>
                                    <td>capture</td>
                                    <td>Boolean</td>
                                    <td>No</td>
                                    <td>Whether to capture payment immediately</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="api-params">
                        <h4>Response Parameters</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>status</td>
                                    <td>String</td>
                                    <td>Status of the request</td>
                                </tr>
                                <tr>
                                    <td>redirect_url</td>
                                    <td>String</td>
                                    <td>URL to redirect for payment</td>
                                </tr>
                                <tr>
                                    <td>order_id</td>
                                    <td>String</td>
                                    <td>Order identifier</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <h3>Payment with Card Tokenization</h3>
                    <div class="api-endpoint">
                        <span class="method">POST</span> /api/credit-card/payment-token
                    </div>
                    
                    <p>Process a payment using a previously stored card token.</p>
                    
                    <div class="api-params">
                        <h4>Request Parameters</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>merchant_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Your merchant ID</td>
                                </tr>
                                <tr>
                                    <td>order_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Unique order identifier</td>
                                </tr>
                                <tr>
                                    <td>amount</td>
                                    <td>Number</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Transaction amount</td>
                                </tr>
                                <tr>
                                    <td>currency</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Currency code (e.g., THB)</td>
                                </tr>
                                <tr>
                                    <td>token</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Card token</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
                
                <!-- QR Payments -->
                <section id="qr-payment" class="api-doc">
                    <h2>QR Payments</h2>
                    
                    <h3>Generate QR</h3>
                    <div class="api-endpoint">
                        <span class="method">POST</span> /api/qr/generate
                    </div>
                    
                    <p>Generate a QR code for payment with mobile banking apps.</p>
                    
                    <div class="api-params">
                        <h4>Request Parameters</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>merchant_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Your merchant ID</td>
                                </tr>
                                <tr>
                                    <td>order_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Unique order identifier</td>
                                </tr>
                                <tr>
                                    <td>amount</td>
                                    <td>Number</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Transaction amount</td>
                                </tr>
                                <tr>
                                    <td>currency</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Currency code (e.g., THB)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="api-params">
                        <h4>Response Parameters</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>status</td>
                                    <td>String</td>
                                    <td>Status of the request</td>
                                </tr>
                                <tr>
                                    <td>qr_image</td>
                                    <td>String</td>
                                    <td>Base64-encoded QR code image</td>
                                </tr>
                                <tr>
                                    <td>order_id</td>
                                    <td>String</td>
                                    <td>Order identifier</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
                
                <!-- Installment Payments -->
                <section id="installment" class="api-doc">
                    <h2>Installment Payments</h2>
                    
                    <h3>Installment Plan Inquiry</h3>
                    <div class="api-endpoint">
                        <span class="method">POST</span> /api/installment/plans
                    </div>
                    
                    <p>Inquire about available installment plans based on the transaction amount.</p>
                    
                    <div class="api-params">
                        <h4>Request Parameters</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>merchant_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Your merchant ID</td>
                                </tr>
                                <tr>
                                    <td>amount</td>
                                    <td>Number</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Transaction amount</td>
                                </tr>
                                <tr>
                                    <td>currency</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Currency code (e.g., THB)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <h3>Installment Payment</h3>
                    <div class="api-endpoint">
                        <span class="method">POST</span> /api/installment/payment
                    </div>
                    
                    <p>Process an installment payment with the selected plan.</p>
                    
                    <div class="api-params">
                        <h4>Request Parameters</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>merchant_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Your merchant ID</td>
                                </tr>
                                <tr>
                                    <td>order_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Unique order identifier</td>
                                </tr>
                                <tr>
                                    <td>amount</td>
                                    <td>Number</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Transaction amount</td>
                                </tr>
                                <tr>
                                    <td>currency</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Currency code (e.g., THB)</td>
                                </tr>
                                <tr>
                                    <td>redirect_url</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>URL to redirect after payment</td>
                                </tr>
                                <tr>
                                    <td>installment_plan</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Selected installment plan (e.g., "3", "6", "10")</td>
                                </tr>
                                <tr>
                                    <td>installment_bank</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Selected bank code (e.g., "KTC", "SCB")</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
                
                <!-- Rabbit Line Pay -->
                <section id="rabbit-line-pay" class="api-doc">
                    <h2>Rabbit Line Pay</h2>
                    
                    <h3>Rabbit Line Pay Payment</h3>
                    <div class="api-endpoint">
                        <span class="method">POST</span> /api/rabbit-line-pay/payment
                    </div>
                    
                    <p>Create a payment using Rabbit Line Pay.</p>
                    
                    <div class="api-params">
                        <h4>Request Parameters</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>merchant_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Your merchant ID</td>
                                </tr>
                                <tr>
                                    <td>order_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Unique order identifier</td>
                                </tr>
                                <tr>
                                    <td>amount</td>
                                    <td>Number</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Transaction amount</td>
                                </tr>
                                <tr>
                                    <td>currency</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Currency code (e.g., THB)</td>
                                </tr>
                                <tr>
                                    <td>redirect_url</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>URL to redirect after payment</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <h3>Pre-Approved Payment</h3>
                    <div class="api-endpoint">
                        <span class="method">POST</span> /api/rabbit-line-pay/preapproved
                    </div>
                    
                    <p>Process a payment using a pre-approved Rabbit Line Pay token.</p>
                    
                    <div class="api-params">
                        <h4>Request Parameters</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>merchant_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Your merchant ID</td>
                                </tr>
                                <tr>
                                    <td>order_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Unique order identifier</td>
                                </tr>
                                <tr>
                                    <td>amount</td>
                                    <td>Number</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Transaction amount</td>
                                </tr>
                                <tr>
                                    <td>currency</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Currency code (e.g., THB)</td>
                                </tr>
                                <tr>
                                    <td>token</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Pre-approved Rabbit Line Pay token</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
                
                <!-- Internet Banking -->
                <section id="internet-banking" class="api-doc">
                    <h2>Internet Banking</h2>
                    
                    <h3>Internet Banking Payment</h3>
                    <div class="api-endpoint">
                        <span class="method">POST</span> /api/banking/payment
                    </div>
                    
                    <p>Create a payment using Internet/Mobile Banking.</p>
                    
                    <div class="api-params">
                        <h4>Request Parameters</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>merchant_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Your merchant ID</td>
                                </tr>
                                <tr>
                                    <td>order_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Unique order identifier</td>
                                </tr>
                                <tr>
                                    <td>amount</td>
                                    <td>Number</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Transaction amount</td>
                                </tr>
                                <tr>
                                    <td>currency</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Currency code (e.g., THB)</td>
                                </tr>
                                <tr>
                                    <td>redirect_url</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>URL to redirect after payment</td>
                                </tr>
                                <tr>
                                    <td>bank_code</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Bank code (e.g., "SCB", "KBANK", "BBL")</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <h3>Request to Pay</h3>
                    <div class="api-endpoint">
                        <span class="method">POST</span> /api/banking/request-to-pay
                    </div>
                    
                    <p>Create a request to pay using Source of Fund (SoF).</p>
                    
                    <div class="api-params">
                        <h4>Request Parameters</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>merchant_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Your merchant ID</td>
                                </tr>
                                <tr>
                                    <td>order_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Unique order identifier</td>
                                </tr>
                                <tr>
                                    <td>amount</td>
                                    <td>Number</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Transaction amount</td>
                                </tr>
                                <tr>
                                    <td>currency</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Currency code (e.g., THB)</td>
                                </tr>
                                <tr>
                                    <td>sof</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Source of Fund (e.g., "SOF_PAOTANG")</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
                
                <!-- Payment Inquiry -->
                <section id="inquiry" class="api-doc">
                    <h2>Payment Inquiry</h2>
                    
                    <h3>Payment Status Inquiry</h3>
                    <div class="api-endpoint">
                        <span class="method">POST</span> /api/payment/inquiry
                    </div>
                    
                    <p>Check the status of a payment.</p>
                    
                    <div class="api-params">
                        <h4>Request Parameters</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>merchant_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Your merchant ID</td>
                                </tr>
                                <tr>
                                    <td>order_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Order identifier to inquire about</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="api-params">
                        <h4>Response Parameters</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>status</td>
                                    <td>String</td>
                                    <td>Payment status (e.g., "SUCCESS", "PENDING", "FAILED")</td>
                                </tr>
                                <tr>
                                    <td>order_id</td>
                                    <td>String</td>
                                    <td>Order identifier</td>
                                </tr>
                                <tr>
                                    <td>amount</td>
                                    <td>Number</td>
                                    <td>Transaction amount</td>
                                </tr>
                                <tr>
                                    <td>payment_method</td>
                                    <td>String</td>
                                    <td>Payment method used</td>
                                </tr>
                                <tr>
                                    <td>payment_channel</td>
                                    <td>String</td>
                                    <td>Payment channel used</td>
                                </tr>
                                <tr>
                                    <td>transaction_time</td>
                                    <td>String</td>
                                    <td>Transaction timestamp</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
                
                <!-- Void & Refund -->
                <section id="void-refund" class="api-doc">
                    <h2>Void & Refund</h2>
                    
                    <h3>Void/Refund Payment</h3>
                    <div class="api-endpoint">
                        <span class="method">POST</span> /api/payment/void-refund
                    </div>
                    
                    <p>Void or refund a payment.</p>
                    
                    <div class="api-params">
                        <h4>Request Parameters</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>merchant_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Your merchant ID</td>
                                </tr>
                                <tr>
                                    <td>order_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Order identifier to void/refund</td>
                                </tr>
                                <tr>
                                    <td>refund_type</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Type of operation ("VOID" or "REFUND")</td>
                                </tr>
                                <tr>
                                    <td>amount</td>
                                    <td>Number</td>
                                    <td>For REFUND only</td>
                                    <td>Refund amount (required for partial refunds)</td>
                                </tr>
                                <tr>
                                    <td>description</td>
                                    <td>String</td>
                                    <td>No</td>
                                    <td>Description of the void/refund</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
                
                <!-- Project Report Documentation -->
                <section id="report" class="api-doc">
                    <h2>Project Report Documentation</h2>
                    
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <p class="mb-0">
                            This documentation provides a comprehensive overview of the mPAY ONE API integration project,
                            including the project structure, implementation details, and code explanations.
                        </p>
                        <a href="/download-report-pdf" class="btn btn-primary" target="_blank">
                            <i data-feather="download" class="me-2"></i> Download PDF Report
                        </a>
                    </div>
                    
                    <h3>Project Structure</h3>
                    <div class="card mb-4">
                        <div class="card-body">
                            <pre><code>
├── api/                     # API endpoint implementations
│   ├── __init__.py          # API package initialization
│   ├── credit_card.py       # Credit card payment APIs
│   ├── installment.py       # Installment payment APIs
│   ├── internet_banking.py  # Internet/mobile banking APIs
│   ├── inquiry.py           # Payment inquiry APIs
│   ├── qr_payment.py        # QR payment generation APIs
│   ├── rabbit_line_pay.py   # Rabbit Line Pay APIs
│   ├── void_refund.py       # Void and refund APIs
│   └── webhook.py           # Webhook handling APIs
├── static/                  # Static assets
│   ├── css/                 # CSS stylesheets
│   │   └── custom.css       # Custom styles for the application
│   └── js/                  # JavaScript files
│       └── script.js        # Main JavaScript functionality
├── templates/               # HTML templates
│   ├── index.html           # Homepage template
│   ├── documentation.html   # API documentation template
│   └── payment_form.html    # Payment form template
├── utils/                   # Utility modules
│   ├── __init__.py          # Utils package initialization
│   ├── http_client.py       # HTTP client for API requests
│   └── signature.py         # Signature generation and verification
├── config.py                # Configuration settings
├── app.py                   # Flask application routes
└── main.py                  # Application entry point
                            </code></pre>
                        </div>
                    </div>
                    
                    <h3>Implementation Details</h3>
                    
                    <h4>1. API Modules</h4>
                    <p>
                        Each API endpoint is implemented as a Flask-RESTful Resource class in dedicated modules within the <code>api/</code> directory.
                        These classes handle HTTP requests, validate input data, generate signatures, and communicate with the mPAY ONE payment gateway.
                    </p>
                    
                    <div class="card mb-3">
                        <div class="card-header">
                            Example: Credit Card Payment Implementation
                        </div>
                        <div class="card-body">
                            <pre><code>
class CreditCardPayment(Resource):
    """Handle Credit Card Payment Order API"""
    
    def post(self):
        """Create a credit card payment order"""
        try:
            payload = request.get_json()
            
            # Validate required fields
            required_fields = ['merchant_id', 'order_id', 'amount', 'currency', 'redirect_url']
            for field in required_fields:
                if field not in payload:
                    return jsonify({"error": ERROR_CODES["INVALID_REQUEST"], "message": f"Missing required field: {field}"}), 400
            
            # Generate signature
            signature = generate_signature(payload)
            payload['signature'] = signature
            
            # Make request to mPAY ONE API
            endpoint = f"{MPAY_ONE_BASE_URL}{CREDIT_CARD_PAYMENT_ENDPOINT}"
            response = make_request('POST', endpoint, payload)
            
            if response.status_code == 200:
                return response.json(), 200
            else:
                logger.error(f"Credit card payment failed: {response.text}")
                return jsonify({"error": ERROR_CODES["PAYMENT_FAILED"], "message": response.text}), response.status_code
                
        except Exception as e:
            logger.exception("Error processing credit card payment")
            return jsonify({"error": ERROR_CODES["SYSTEM_ERROR"], "message": str(e)}), 500
                            </code></pre>
                        </div>
                    </div>
                    
                    <h4>2. Authentication and Security</h4>
                    <p>
                        The integration uses HMAC SHA-256 signatures for securing API requests and verifying webhook notifications.
                        Signatures are generated based on the request payload and a secret key.
                    </p>
                    
                    <div class="card mb-3">
                        <div class="card-header">
                            Signature Generation Implementation
                        </div>
                        <div class="card-body">
                            <pre><code>
def generate_signature(data):
    """
    Generate HMAC signature for the request payload
    
    Args:
        data (dict): Payload data to sign
        
    Returns:
        str: The hexadecimal signature string
    """
    try:
        # Sort the payload keys alphabetically
        sorted_data = {k: data[k] for k in sorted(data.keys())}
        
        # Convert payload to JSON string
        payload_string = json.dumps(sorted_data, separators=(',', ':'))
        
        # Create HMAC with SHA-256
        signature = hmac.new(
            MPAY_SECRET_KEY.encode('utf-8'),
            payload_string.encode('utf-8'),
            hashlib.sha256
        ).hexdigest()
        
        return signature
    
    except Exception as e:
        logger.exception(f"Error generating signature: {str(e)}")
        raise
                            </code></pre>
                        </div>
                    </div>
                    
                    <h4>3. HTTP Client</h4>
                    <p>
                        A custom HTTP client handles communication with the mPAY ONE API, managing request formatting,
                        error handling, and response processing.
                    </p>
                    
                    <div class="card mb-3">
                        <div class="card-header">
                            HTTP Client Implementation
                        </div>
                        <div class="card-body">
                            <pre><code>
def make_request(method, url, data=None, headers=None, timeout=30):
    """
    Make HTTP request to mPAY ONE API
    
    Args:
        method (str): HTTP method (GET, POST, PUT, DELETE)
        url (str): Request URL
        data (dict, optional): Request payload
        headers (dict, optional): Request headers
        timeout (int, optional): Request timeout in seconds
        
    Returns:
        requests.Response: Response object
    
    Raises:
        RequestException: If request fails
    """
    if headers is None:
        headers = {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
        }
    
    try:
        logger.debug(f"Making {method} request to {url}")
        response = requests.request(
            method=method,
            url=url,
            json=data,
            headers=headers,
            timeout=timeout
        )
        
        # Return the response even if status code indicates error
        return response
    
    except RequestException as e:
        logger.error(f"HTTP request failed: {str(e)}")
        
        if hasattr(e, 'response') and e.response is not None:
            return e.response
        
        # Re-raise the exception if no response
        raise
                            </code></pre>
                        </div>
                    </div>
                    
                    <h4>4. Webhook Handling</h4>
                    <p>
                        The system processes webhook notifications from mPAY ONE to receive real-time payment status updates.
                        Webhooks are validated using signature verification to ensure their authenticity.
                    </p>
                    
                    <div class="card mb-3">
                        <div class="card-header">
                            Webhook Handler Implementation
                        </div>
                        <div class="card-body">
                            <pre><code>
class WebhookHandler(Resource):
    """Handle Webhook Notifications from mPAY ONE"""
    
    def post(self):
        """Process webhook notifications from mPAY ONE"""
        try:
            webhook_data = request.get_json()
            
            if not webhook_data:
                logger.error("Empty webhook payload received")
                return jsonify({"status": "error", "message": "No data received"}), 400
            
            # Verify signature
            signature = webhook_data.pop('signature', None)
            
            if not signature:
                logger.error("Webhook signature missing")
                return jsonify({"status": "error", "message": "Signature missing"}), 400
            
            # Verify the signature
            if not verify_signature(webhook_data, signature):
                logger.error("Webhook signature verification failed")
                return jsonify({"status": "error", "message": "Invalid signature"}), 401
            
            # Process the webhook based on status
            status = webhook_data.get('status')
            order_id = webhook_data.get('order_id')
            
            # Update your system based on payment status
            if status == 'SUCCESS':
                logger.info(f"Payment successful for order {order_id}")
                # Update order status to paid
                
            elif status == 'PENDING':
                logger.info(f"Payment pending for order {order_id}")
                # Update order status to pending
                
            elif status == 'FAILED':
                logger.info(f"Payment failed for order {order_id}")
                # Update order status to failed
            
            # Always return 200 OK to acknowledge receipt
            return jsonify({"status": "success", "message": "Webhook received"}), 200
            
        except Exception as e:
            logger.exception("Error processing webhook")
            # Still return 200 to prevent redelivery, but log the error
            return jsonify({"status": "error", "message": str(e)}), 200
                            </code></pre>
                        </div>
                    </div>
                    
                    <h4>5. Frontend Integration</h4>
                    <p>
                        The frontend provides a user-friendly interface for initiating payments, selecting payment methods,
                        and viewing transaction details. It communicates with the backend API to process payments and display results.
                    </p>
                    
                    <div class="card mb-3">
                        <div class="card-header">
                            Payment Form Handler in JavaScript
                        </div>
                        <div class="card-body">
                            <pre><code>
function initPaymentForm() {
    const paymentForm = document.getElementById('payment-form');
    
    if (paymentForm) {
        paymentForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Show loading spinner
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalBtnText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '&lt;span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"&gt;&lt;/span&gt; Processing...';
            
            // Get selected payment method
            const paymentMethod = document.querySelector('input[name="payment_method"]:checked').value;
            
            try {
                // Build form data based on payment method
                const formData = buildFormData(paymentMethod);
                
                // Call appropriate API endpoint
                const endpoint = getEndpointForPaymentMethod(paymentMethod);
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    handleSuccessResponse(result, paymentMethod);
                } else {
                    handleErrorResponse(result);
                }
            } catch (error) {
                console.error('Payment processing error:', error);
                showErrorMessage('An unexpected error occurred. Please try again.');
            } finally {
                // Restore submit button
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalBtnText;
            }
        });
    }
}
                            </code></pre>
                        </div>
                    </div>
                    
                    <h3>Configuration Settings</h3>
                    <p>
                        The application uses a central configuration file (<code>config.py</code>) to manage API endpoints,
                        secret keys, error codes, and other settings. This centralized approach allows for easy updates and maintenance.
                    </p>
                    
                    <div class="card mb-3">
                        <div class="card-header">
                            Configuration Example
                        </div>
                        <div class="card-body">
                            <pre><code>
# mPAY ONE API configuration
MPAY_ONE_BASE_URL = "https://api.mpayone.com/v4"
MPAY_SECRET_KEY = os.environ.get("MPAY_SECRET_KEY", "your_secret_key_here")

# API endpoints
CREDIT_CARD_PAYMENT_ENDPOINT = "/payment/credit-card"
QR_PAYMENT_ENDPOINT = "/payment/qr-code"
INSTALLMENT_PAYMENT_ENDPOINT = "/payment/installment"
RABBIT_LINE_PAY_ENDPOINT = "/payment/rabbit-line-pay"
INTERNET_BANKING_ENDPOINT = "/payment/internet-banking"
PAYMENT_INQUIRY_ENDPOINT = "/payment/inquiry"
VOID_REFUND_ENDPOINT = "/payment/void-refund"

# Error codes
ERROR_CODES = {
    "INVALID_REQUEST": "E001",
    "AUTHENTICATION_FAILED": "E002",
    "PAYMENT_FAILED": "E003",
    "RESOURCE_NOT_FOUND": "E004",
    "SYSTEM_ERROR": "E999"
}
                            </code></pre>
                        </div>
                    </div>
                    
                    <h3>Testing and Integration</h3>
                    <p>
                        To test the integration with mPAY ONE, follow these steps:
                    </p>
                    
                    <ol>
                        <li>
                            <strong>Set up your environment:</strong> Configure your merchant ID and secret key in your environment variables or configuration file.
                        </li>
                        <li>
                            <strong>Test API endpoints:</strong> Use the payment form provided in this implementation to test different payment methods.
                        </li>
                        <li>
                            <strong>Configure webhooks:</strong> Set up a publicly accessible URL for receiving webhook notifications and configure it in your mPAY ONE merchant dashboard.
                        </li>
                        <li>
                            <strong>Monitor transactions:</strong> Use the payment inquiry API to check transaction status and monitor webhook notifications for real-time updates.
                        </li>
                    </ol>
                    
                    <h3>Best Practices</h3>
                    <ul>
                        <li>
                            <strong>Security:</strong> Always validate signatures on incoming webhook notifications and never expose your secret key in client-side code.
                        </li>
                        <li>
                            <strong>Error handling:</strong> Implement comprehensive error handling to provide clear feedback to users when payments fail.
                        </li>
                        <li>
                            <strong>Logging:</strong> Maintain detailed logs of all API requests, responses, and webhook notifications for troubleshooting and auditing.
                        </li>
                        <li>
                            <strong>Idempotency:</strong> Ensure that payment operations can safely be retried without creating duplicate transactions by using unique order IDs.
                        </li>
                        <li>
                            <strong>Testing:</strong> Thoroughly test the integration in a sandbox environment before going live with real transactions.
                        </li>
                    </ul>
                </section>
                
                <!-- Webhook Notifications -->
                <section id="webhook" class="api-doc">
                    <h2>Webhook Notifications</h2>
                    
                    <p>
                        mPAY ONE sends webhook notifications to inform your system about payment status changes.
                        Configure your webhook endpoint in the mPAY ONE dashboard.
                    </p>
                    
                    <div class="api-endpoint">
                        <span class="method">POST</span> /api/webhook
                    </div>
                    
                    <p>Endpoint on your server to receive webhook notifications.</p>
                    
                    <div class="api-params">
                        <h4>Webhook Payload</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>merchant_id</td>
                                    <td>String</td>
                                    <td>Your merchant ID</td>
                                </tr>
                                <tr>
                                    <td>order_id</td>
                                    <td>String</td>
                                    <td>Order identifier</td>
                                </tr>
                                <tr>
                                    <td>payment_id</td>
                                    <td>String</td>
                                    <td>Payment identifier</td>
                                </tr>
                                <tr>
                                    <td>status</td>
                                    <td>String</td>
                                    <td>Payment status (SUCCESS, PENDING, FAILED, etc.)</td>
                                </tr>
                                <tr>
                                    <td>amount</td>
                                    <td>Number</td>
                                    <td>Transaction amount</td>
                                </tr>
                                <tr>
                                    <td>currency</td>
                                    <td>String</td>
                                    <td>Currency code</td>
                                </tr>
                                <tr>
                                    <td>payment_method</td>
                                    <td>String</td>
                                    <td>Payment method used</td>
                                </tr>
                                <tr>
                                    <td>transaction_time</td>
                                    <td>String</td>
                                    <td>ISO 8601 timestamp</td>
                                </tr>
                                <tr>
                                    <td>signature</td>
                                    <td>String</td>
                                    <td>HMAC signature for verification</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <h3>Verifying Webhooks</h3>
                    <p>
                        Always verify webhook signatures to ensure they come from mPAY ONE:
                    </p>
                    
                    <div class="card mb-3">
                        <div class="card-body">
                            <pre><code>
# Example in Python
def verify_webhook(payload, signature, secret_key):
    # Remove signature from payload for verification
    payload_for_signature = payload.copy()
    payload_for_signature.pop('signature', None)
    
    # Generate expected signature
    expected_signature = generate_signature(payload_for_signature, secret_key)
    
    # Compare with received signature
    return hmac.compare_digest(expected_signature, signature)
                            </code></pre>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="api-footer">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <p>mPAY ONE API Documentation &copy; 2024</p>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Scripts -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Feather icons
            feather.replace();
            
            // Smooth scrolling for anchor links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    
                    document.querySelector(this.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });
        });
    </script>
</body>
</html>
