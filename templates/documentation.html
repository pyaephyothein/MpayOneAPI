<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Documentation - mPAY ONE API Integration</title>
    <link rel="stylesheet" href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="api-header">
        <div class="container">
            <div class="row">
                <div class="col-md-12 text-center">
                    <h1>mPAY ONE API Documentation</h1>
                    <p class="lead">Reference for integrating the mPAY ONE payment gateway</p>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="container">
        <div class="row">
            <div class="col-md-3">
                <!-- Sidebar Navigation -->
                <div class="sticky-top pt-4">
                    <div class="list-group mb-4">
                        <a href="#introduction" class="list-group-item list-group-item-action">Introduction</a>
                        <a href="#authentication" class="list-group-item list-group-item-action">Authentication</a>
                        <a href="#credit-card" class="list-group-item list-group-item-action">Credit Card Payments</a>
                        <a href="#qr-payment" class="list-group-item list-group-item-action">QR Payments</a>
                        <a href="#installment" class="list-group-item list-group-item-action">Installment Payments</a>
                        <a href="#rabbit-line-pay" class="list-group-item list-group-item-action">Rabbit Line Pay</a>
                        <a href="#internet-banking" class="list-group-item list-group-item-action">Internet Banking</a>
                        <a href="#inquiry" class="list-group-item list-group-item-action">Payment Inquiry</a>
                        <a href="#void-refund" class="list-group-item list-group-item-action">Void & Refund</a>
                        <a href="#webhook" class="list-group-item list-group-item-action">Webhook Notifications</a>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
                            <i data-feather="home" class="feather-sm"></i> Back to Home
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-9">
                <!-- Introduction -->
                <section id="introduction" class="api-doc">
                    <h2>Introduction</h2>
                    <p>
                        The mPAY ONE API allows you to integrate payment processing functionality into your website.
                        This documentation covers the main endpoints and features available through our integration.
                    </p>
                    <p>
                        The API provides endpoints for processing various payment methods, including credit cards,
                        QR payments, installment plans, and alternative payment methods.
                    </p>
                </section>
                
                <!-- Authentication -->
                <section id="authentication" class="api-doc">
                    <h2>Authentication</h2>
                    <p>
                        All API requests require a valid merchant ID and signature. The signature is generated using
                        HMAC SHA-256 with your secret key.
                    </p>
                    
                    <h3>Signature Generation</h3>
                    <div class="card mb-3">
                        <div class="card-body">
                            <pre><code>
// Example in Python
import hmac
import hashlib
import json

def generate_signature(data, secret_key):
    # Sort the payload keys alphabetically
    sorted_data = {k: data[k] for k in sorted(data.keys())}
    
    # Convert payload to JSON string
    payload_string = json.dumps(sorted_data, separators=(',', ':'))
    
    # Create HMAC with SHA-256
    signature = hmac.new(
        secret_key.encode('utf-8'),
        payload_string.encode('utf-8'),
        hashlib.sha256
    ).hexdigest()
    
    return signature
                            </code></pre>
                        </div>
                    </div>
                </section>
                
                <!-- Credit Card Payments -->
                <section id="credit-card" class="api-doc">
                    <h2>Credit Card Payments</h2>
                    
                    <h3>Payment Order</h3>
                    <div class="api-endpoint">
                        <span class="method">POST</span> /api/credit-card/payment
                    </div>
                    
                    <p>Create a credit card payment order to redirect the customer to the payment page.</p>
                    
                    <div class="api-params">
                        <h4>Request Parameters</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>merchant_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Your merchant ID</td>
                                </tr>
                                <tr>
                                    <td>order_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Unique order identifier</td>
                                </tr>
                                <tr>
                                    <td>amount</td>
                                    <td>Number</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Transaction amount</td>
                                </tr>
                                <tr>
                                    <td>currency</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Currency code (e.g., THB)</td>
                                </tr>
                                <tr>
                                    <td>redirect_url</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>URL to redirect after payment</td>
                                </tr>
                                <tr>
                                    <td>description</td>
                                    <td>String</td>
                                    <td>No</td>
                                    <td>Payment description</td>
                                </tr>
                                <tr>
                                    <td>capture</td>
                                    <td>Boolean</td>
                                    <td>No</td>
                                    <td>Whether to capture payment immediately</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="api-params">
                        <h4>Response Parameters</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>status</td>
                                    <td>String</td>
                                    <td>Status of the request</td>
                                </tr>
                                <tr>
                                    <td>redirect_url</td>
                                    <td>String</td>
                                    <td>URL to redirect for payment</td>
                                </tr>
                                <tr>
                                    <td>order_id</td>
                                    <td>String</td>
                                    <td>Order identifier</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <h3>Payment with Card Tokenization</h3>
                    <div class="api-endpoint">
                        <span class="method">POST</span> /api/credit-card/payment-token
                    </div>
                    
                    <p>Process a payment using a previously stored card token.</p>
                    
                    <div class="api-params">
                        <h4>Request Parameters</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>merchant_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Your merchant ID</td>
                                </tr>
                                <tr>
                                    <td>order_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Unique order identifier</td>
                                </tr>
                                <tr>
                                    <td>amount</td>
                                    <td>Number</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Transaction amount</td>
                                </tr>
                                <tr>
                                    <td>currency</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Currency code (e.g., THB)</td>
                                </tr>
                                <tr>
                                    <td>token</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Card token</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
                
                <!-- QR Payments -->
                <section id="qr-payment" class="api-doc">
                    <h2>QR Payments</h2>
                    
                    <h3>Generate QR</h3>
                    <div class="api-endpoint">
                        <span class="method">POST</span> /api/qr/generate
                    </div>
                    
                    <p>Generate a QR code for payment with mobile banking apps.</p>
                    
                    <div class="api-params">
                        <h4>Request Parameters</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>merchant_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Your merchant ID</td>
                                </tr>
                                <tr>
                                    <td>order_id</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Unique order identifier</td>
                                </tr>
                                <tr>
                                    <td>amount</td>
                                    <td>Number</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Transaction amount</td>
                                </tr>
                                <tr>
                                    <td>currency</td>
                                    <td>String</td>
                                    <td><span class="required">Yes</span></td>
                                    <td>Currency code (e.g., THB)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="api-params">
                        <h4>Response Parameters</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>status</td>
                                    <td>String</td>
                                    <td>Status of the request</td>
                                </tr>
                                <tr>
                                    <td>qr_image</td>
                                    <td>String</td>
                                    <td>Base64-encoded QR code image</td>
                                </tr>
                                <tr>
                                    <td>order_id</td>
                                    <td>String</td>
                                    <td>Order identifier</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
                
                <!-- More API documentation sections would follow a similar pattern -->
                
                <!-- Webhook Notifications -->
                <section id="webhook" class="api-doc">
                    <h2>Webhook Notifications</h2>
                    
                    <p>
                        mPAY ONE sends webhook notifications to inform your system about payment status changes.
                        Configure your webhook endpoint in the mPAY ONE dashboard.
                    </p>
                    
                    <div class="api-endpoint">
                        <span class="method">POST</span> /api/webhook
                    </div>
                    
                    <p>Endpoint on your server to receive webhook notifications.</p>
                    
                    <div class="api-params">
                        <h4>Webhook Payload</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>merchant_id</td>
                                    <td>String</td>
                                    <td>Your merchant ID</td>
                                </tr>
                                <tr>
                                    <td>order_id</td>
                                    <td>String</td>
                                    <td>Order identifier</td>
                                </tr>
                                <tr>
                                    <td>payment_id</td>
                                    <td>String</td>
                                    <td>Payment identifier</td>
                                </tr>
                                <tr>
                                    <td>status</td>
                                    <td>String</td>
                                    <td>Payment status (SUCCESS, PENDING, FAILED, etc.)</td>
                                </tr>
                                <tr>
                                    <td>amount</td>
                                    <td>Number</td>
                                    <td>Transaction amount</td>
                                </tr>
                                <tr>
                                    <td>currency</td>
                                    <td>String</td>
                                    <td>Currency code</td>
                                </tr>
                                <tr>
                                    <td>payment_method</td>
                                    <td>String</td>
                                    <td>Payment method used</td>
                                </tr>
                                <tr>
                                    <td>transaction_time</td>
                                    <td>String</td>
                                    <td>ISO 8601 timestamp</td>
                                </tr>
                                <tr>
                                    <td>signature</td>
                                    <td>String</td>
                                    <td>HMAC signature for verification</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <h3>Verifying Webhooks</h3>
                    <p>
                        Always verify webhook signatures to ensure they come from mPAY ONE:
                    </p>
                    
                    <div class="card mb-3">
                        <div class="card-body">
                            <pre><code>
# Example in Python
def verify_webhook(payload, signature, secret_key):
    # Remove signature from payload for verification
    payload_for_signature = payload.copy()
    payload_for_signature.pop('signature', None)
    
    # Generate expected signature
    expected_signature = generate_signature(payload_for_signature, secret_key)
    
    # Compare with received signature
    return hmac.compare_digest(expected_signature, signature)
                            </code></pre>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="api-footer">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <p>mPAY ONE API Documentation &copy; 2024</p>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Scripts -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Feather icons
            feather.replace();
            
            // Smooth scrolling for anchor links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    
                    document.querySelector(this.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });
        });
    </script>
</body>
</html>
